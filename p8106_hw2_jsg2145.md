p8106\_hw2\_jsg2145
================
Jared Garfinkel
3/16/2020

``` r
collegedf = read_csv("./data/College.csv") %>% 
  janitor::clean_names() %>% 
  mutate(college = factor(college)) %>% 
  select(outstate, everything())
```

    ## Parsed with column specification:
    ## cols(
    ##   College = col_character(),
    ##   Apps = col_double(),
    ##   Accept = col_double(),
    ##   Enroll = col_double(),
    ##   Top10perc = col_double(),
    ##   Top25perc = col_double(),
    ##   F.Undergrad = col_double(),
    ##   P.Undergrad = col_double(),
    ##   Outstate = col_double(),
    ##   Room.Board = col_double(),
    ##   Books = col_double(),
    ##   Personal = col_double(),
    ##   PhD = col_double(),
    ##   Terminal = col_double(),
    ##   S.F.Ratio = col_double(),
    ##   perc.alumni = col_double(),
    ##   Expend = col_double(),
    ##   Grad.Rate = col_double()
    ## )

``` r
college.train = collegedf %>% 
  filter(college != "Columbia University")
```

``` r
x.train = model.matrix(outstate ~ apps + accept + enroll + top10perc + top25perc + f_undergrad + p_undergrad + room_board + books + personal + ph_d + terminal + s_f_ratio + perc_alumni + expend + grad_rate, college.train)[,-1]

y.train = pull(college.train, outstate)

ctrl1 = trainControl(method = "cv", number = 5)
```

``` r
college.pcr = train(x.train, y.train,
                    method = "pcr",
                    tuneLength = ncol(college.train) - 1,
                    trControl = ctrl1,
                    preProc = c("center", "scale"))
```

``` r
ggplot(college.pcr, highlight = TRUE)
```

<img src="p8106_hw2_jsg2145_files/figure-gfm/unnamed-chunk-3-1.png" width="90%" />

``` r
cv.lasso = cv.glmnet(x.train, y.train, 
                     type.measure = "mse", 
                     alpha = 1, 
                     lambda = exp(seq(2, 5, length = 100)))

plot(cv.lasso)
```

<img src="p8106_hw2_jsg2145_files/figure-gfm/lasso in glmnet-1.png" width="90%" />

``` r
cv.ridge = cv.glmnet(x.train, y.train, 
                     type.measure = "mse", 
                     alpha = 0, 
                     lambda = exp(seq(3, 8, length = 100)))

plot(cv.ridge)
```

<img src="p8106_hw2_jsg2145_files/figure-gfm/ridge in glmnet-1.png" width="90%" />

``` r
college.lasso = train(x.train, y.train,
                    method = "glmnet",
                    tuneGrid = expand.grid(alpha = 1, 
                                          lambda = exp(seq(2, 5, length = 100))),
                    trControl = ctrl1)
```

``` r
college.ridge = train(x.train, y.train,
                    method = "glmnet",
                    tuneGrid = expand.grid(alpha = 0, 
                                          lambda = exp(seq(3, 8, length = 100))),
                    trControl = ctrl1)
```

``` r
college.lm <- train(x.train, y.train,
                method = "lm",
                trControl = ctrl1)
```

``` r
p1 = college.train %>% 
  ggplot(aes(x = apps, y = outstate)) +
  geom_point()

p2 = college.train %>% 
  ggplot(aes(x = accept, y = outstate)) +
  geom_point()

p3 = college.train %>% 
  ggplot(aes(x = enroll, y = outstate)) +
  geom_point()

p4 = college.train %>% 
  ggplot(aes(x = top10perc, y = outstate)) +
  geom_point()

p5 = college.train %>% 
  ggplot(aes(x = top25perc, y = outstate)) +
  geom_point()

p6 = college.train %>% 
  ggplot(aes(x = f_undergrad, y = outstate)) +
  geom_point()

p7 = college.train %>% 
  ggplot(aes(x = p_undergrad, y = outstate)) +
  geom_point()

p8 = college.train %>% 
  ggplot(aes(x = room_board, y = outstate)) +
  geom_point()

p9 = college.train %>% 
  ggplot(aes(x = books, y = outstate)) +
  geom_point()

college.train %>% 
  ggplot(aes(x = ph_d, y = outstate)) +
  geom_point()
```

<img src="p8106_hw2_jsg2145_files/figure-gfm/unnamed-chunk-5-1.png" width="90%" />

``` r
p10 = college.train %>% 
  ggplot(aes(x = personal, y = outstate)) +
  geom_point()

p11 = college.train %>% 
  ggplot(aes(x = terminal, y = outstate)) +
  geom_point()

p12 = college.train %>% 
  ggplot(aes(x = s_f_ratio, y = outstate)) +
  geom_point()

p13 = college.train %>% 
  ggplot(aes(x = perc_alumni, y = outstate)) +
  geom_point()

p14 = college.train %>% 
  ggplot(aes(x = grad_rate, y = outstate)) +
  geom_point()

p15 = college.train %>% 
  ggplot(aes(x = expend, y = outstate)) +
  geom_point() + 
  scale_x_continuous(breaks = c(0, 20000, 40000, 65000))
```

``` r
plots = list(p1, p2, p3, p4, p5, p6, p7, p8, p9, p10, p11, p12, p13, p14, p15)

wrap_plots(plots, ncol = 3)
```

<img src="p8106_hw2_jsg2145_files/figure-gfm/unnamed-chunk-6-1.png" width="90%" />

``` r
spline.term9 = smooth.spline(pull(college.train, terminal), pull(college.train, outstate), df = 9)
spline.term10 = smooth.spline(pull(college.train, terminal), pull(college.train, outstate), df = 10)
spline.term11 = smooth.spline(pull(college.train, terminal), pull(college.train, outstate), df = 11)
spline.term12 = smooth.spline(pull(college.train, terminal), pull(college.train, outstate), df = 12)
spline.term13 = smooth.spline(pull(college.train, terminal), pull(college.train, outstate), df = 13)
spline.termA = smooth.spline(pull(college.train, terminal), pull(college.train, outstate), cv = TRUE)
spline.termA$df
```

    ## [1] 4.686019

``` r
plot(college.train$terminal, college.train$outstate)
points(x.train, cex = .5, 
       col = "darkgrey")
lines(spline.term11, col = "red ", lwd = 2)
lines(spline.termA, col = "blue", lwd = 2)
legend("topright", legend = c("11 DF", "4.7 DF"),
       col = c("red", "blue"), lty = 1, lwd = 2, cex = .8)
```

<img src="p8106_hw2_jsg2145_files/figure-gfm/unnamed-chunk-7-1.png" width="90%" />

``` r
gam1 = gam(outstate ~ apps + accept + enroll + top10perc + top25perc + f_undergrad + p_undergrad + room_board + books + personal + ph_d + terminal + s_f_ratio + perc_alumni + expend + grad_rate, data = college.train)
```

``` r
par(mfrow = c(4,4))
plot(gam1, pages=1,residuals=TRUE,all.terms=TRUE,shade=TRUE,shade.col=2)
```

<img src="p8106_hw2_jsg2145_files/figure-gfm/unnamed-chunk-9-1.png" width="90%" />

``` r
vis.gam(gam1, view = c("apps", "accept"),
        plot.type = "contour", color = "topo")
```

<img src="p8106_hw2_jsg2145_files/figure-gfm/unnamed-chunk-9-2.png" width="90%" />

``` r
set.seed(22)
college.gam = train(x.train, y.train,
                    method = "gam",
                    tuneGrid = data.frame(method = "GCV.Cp", 
                                         select = c(TRUE,FALSE)),
                    trControl = ctrl1)

college.gam$bestTune
```

    ##   select method
    ## 1  FALSE GCV.Cp

``` r
college.gam$finalModel
```

    ## 
    ## Family: gaussian 
    ## Link function: identity 
    ## 
    ## Formula:
    ## .outcome ~ s(perc_alumni) + s(terminal) + s(top10perc) + s(ph_d) + 
    ##     s(grad_rate) + s(books) + s(top25perc) + s(s_f_ratio) + s(personal) + 
    ##     s(p_undergrad) + s(enroll) + s(room_board) + s(accept) + 
    ##     s(f_undergrad) + s(apps) + s(expend)
    ## 
    ## Estimated degrees of freedom:
    ## 1.90 5.14 3.64 6.32 4.27 2.35 1.00 
    ## 4.33 1.00 1.00 1.00 2.13 3.58 6.28 
    ## 4.59 6.45  total = 55.98 
    ## 
    ## GCV score: 2761951

``` r
college.spline = train(x.train, y.train,
                       method = "earth", tuneLength = 17, trControl = ctrl1)
```

    ## Loading required package: earth

    ## Loading required package: Formula

    ## Loading required package: plotmo

    ## Loading required package: plotrix

    ## Loading required package: TeachingDemos

``` r
plot(college.spline)
```

<img src="p8106_hw2_jsg2145_files/figure-gfm/unnamed-chunk-10-1.png" width="90%" />

``` r
partial(college.spline, pred.var = "expend", plot = TRUE, rug = TRUE)
```

<img src="p8106_hw2_jsg2145_files/figure-gfm/unnamed-chunk-10-2.png" width="90%" />

``` r
resamp <- resamples(list(lasso = college.lasso, 
                         ridge = college.ridge, 
                         pcr = college.pcr,
                         lm = college.lm,
                         spline = college.spline,
                         gam = college.gam))

summary(resamp)
```

    ## 
    ## Call:
    ## summary.resamples(object = resamp)
    ## 
    ## Models: lasso, ridge, pcr, lm, spline, gam 
    ## Number of resamples: 5 
    ## 
    ## MAE 
    ##            Min.  1st Qu.   Median     Mean  3rd Qu.     Max. NA's
    ## lasso  1504.695 1519.222 1577.349 1585.934 1598.318 1730.086    0
    ## ridge  1489.322 1513.312 1515.869 1602.100 1742.693 1749.306    0
    ## pcr    1457.506 1574.423 1600.106 1604.172 1604.552 1784.273    0
    ## lm     1444.158 1472.863 1608.825 1564.111 1642.648 1652.059    0
    ## spline 1304.020 1308.502 1351.310 1359.150 1367.087 1464.831    0
    ## gam    1305.207 1369.317 1376.875 1384.362 1393.167 1477.245    0
    ## 
    ## RMSE 
    ##            Min.  1st Qu.   Median     Mean  3rd Qu.     Max. NA's
    ## lasso  1795.073 1835.576 2014.855 1983.840 2114.503 2159.194    0
    ## ridge  1846.796 1855.816 1979.126 2002.046 2106.601 2221.889    0
    ## pcr    1785.601 1997.429 2050.201 2016.194 2093.589 2154.150    0
    ## lm     1771.207 1860.777 2022.568 1974.482 2053.131 2164.731    0
    ## spline 1600.466 1667.612 1709.368 1749.716 1794.982 1976.150    0
    ## gam    1613.150 1770.887 1808.560 1788.702 1865.690 1885.225    0
    ## 
    ## Rsquared 
    ##             Min.   1st Qu.    Median      Mean   3rd Qu.      Max. NA's
    ## lasso  0.6699312 0.7077152 0.7150016 0.7163042 0.7273525 0.7615204    0
    ## ridge  0.6670419 0.6955477 0.7149033 0.7110279 0.7206432 0.7570035    0
    ## pcr    0.6487024 0.6782934 0.7027982 0.7044073 0.7112638 0.7809787    0
    ## lm     0.6683294 0.6794924 0.6836230 0.7144728 0.7653010 0.7756182    0
    ## spline 0.7487180 0.7546039 0.7868256 0.7838266 0.8063247 0.8226606    0
    ## gam    0.7228419 0.7489326 0.7796175 0.7721217 0.7929478 0.8162689    0

``` r
bwplot(resamp, metric = "RMSE")
```

<img src="p8106_hw2_jsg2145_files/figure-gfm/results-1.png" width="90%" />

``` r
columbia = collegedf %>% 
  filter(college == "Columbia University")

pred.spline = predict(college.spline, newdata = columbia)

pred.gam = predict(gam1, newdata = columbia)
```
